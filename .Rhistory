params = c(m=13, B1 = 1.285935e-05, B2 = 1.214533e-05, B3 = 1.464063e-05, B4 = 1.277254e-05, B5 = 1.236623e-05, B6 = 1.181611e-05,
B7 = 1.059032e-05, B8 = 1.183479e-05, B9 = 1.024478e-05, B10 = 1.099727e-05,
B11 = 1.065480e-05, B12 = 1.136872e-05, B13 = 9.970371e-06, B14 = 9.655970e-06, B15 = 8.828046e-06, B16 = 8.999024e-06 ,
B17 = 6.775660e-06, B18 = 6.917613e-06, B19 = 7.245048e-06, B20 = 1.110509e-05,
B21 = 1.418629e-05, B22 = 1.017632e-05, B23 = 1.180947e-05, B24 = 1.052219e-05, B25 = 1.050035e-05 , B26 = 1.175871e-05,
alpha = 9.70e-01 , Sbar = 114281.6),
statenames=c("I","lambda","theta"),
rmeasure = rmeas,
dmeasure = dmeas,
toEstimationScale = toEst,
fromEstimationScale = fromEst,
covar = Covar,
tcovar= "time") -> TSIR
plot(simulate(TSIR))
firstFit <- mif2(TSIR, Nmif = 150, Np = 1000, #10 was 10000
rw.sd = rw.sd(
m=0.03, alpha=0.03, Sbar=0.03,
B1 = .10, B2 = .10, B3 = .10, B4 = .10, B5 = .10, B6 = .10, B7 = .10, B8 = .10, B9 = .10, B10 = .10,
B11 = .10, B12 = .10, B13 = .10, B14 = .10, B15 = .10, B16 = .10, B17 = .10, B18 = .10, B19 = .10, B20 = .10,
B21 = .10, B22 = .10, B23 = .10, B24 = .10, B25 = .10, B26 = .10),
transform = T,
cooling.type = "geometric", cooling.fraction.50 = .05,
tol = 1e-17, max.fail = Inf, verbose = getOption("verbose"))
coef(TSIR)<-coef(firstFit)
TSIR %>%
simulate(params=coef(firstFit),nsim=5,as.data.frame=TRUE,include.data=TRUE) %>%
ggplot(aes(x=time,y=cases,group=sim,color=(sim=="data")))+
guides(color=FALSE)+
geom_line()+facet_wrap(~sim,ncol=2)+ ggtitle("TSIR Cases Reconstruction")+theme_bw()
TSIR %>%
simulate(params=coef(firstFit),nsim=100,as.data.frame=TRUE,include.data=TRUE) %>%
subset(select=c(time,sim,cases)) %>%
mutate(data=sim=="data") %>%
ddply(~time+data,summarize,
p=c(0.05,0.5,0.95),q=quantile(cases,prob=p,names=FALSE)) %>%
mutate(p=mapvalues(p,from=c(0.05,0.5,0.95),to=c("lo","med","hi")),
data=mapvalues(data,from=c(TRUE,FALSE),to=c("data","simulation"))) %>%
dcast(time+data~p,value.var='q') %>%
ggplot(aes(x=time,y=med,color=data,fill=data,ymin=lo,ymax=hi))+
geom_ribbon(alpha=0.2)+ theme_bw() + ylab("cases") + ggtitle("TSIR cases reconstructed with Data")
saveRDS(firstFit, file = "firstFitTSIR.rda")
TSIRsim %>%
simulate(params=coef(TSIRsim),nsim=100,as.data.frame=TRUE,include.data=TRUE) %>%
subset(select=c(time,sim,cases)) %>%
mutate(data=sim=="data") %>%
ddply(~time+data,summarize,
p=c(0.05,0.5,0.95),q=quantile(cases,prob=p,names=FALSE)) %>%
mutate(p=mapvalues(p,from=c(0.05,0.5,0.95),to=c("lo","med","hi")),
data=mapvalues(data,from=c(TRUE,FALSE),to=c("data","simulation"))) %>%
dcast(time+data~p,value.var='q') %>%
ggplot(aes(x=time,y=med,color=data,fill=data,ymin=lo,ymax=hi))+
geom_ribbon(alpha=0.2)+ theme_bw() + ylab("cases") + ggtitle("TSIR cases with Data")
TSIRsim %>%
simulate(params=coef(TSIRsim),nsim=100,as.data.frame=TRUE,times= seq(1944,1985,by=7/365),include.data=TRUE) %>%
subset(select=c(time,sim,cases)) %>%
mutate(data=sim=="data") %>%
ddply(~time+data,summarize,
p=c(0.05,0.5,0.95),q=quantile(cases,prob=p,names=FALSE),mean_cases=mean(cases)) %>%
mutate(p=mapvalues(p,from=c(0.05,0.5,0.95),to=c("lo","med","hi")),
data=mapvalues(data,from=c(TRUE,FALSE),to=c("data","simulation"))) %>%
dcast(time+data~p,value.var='q') %>%
ggplot(aes(x=time,y=med,color=data,fill=data,ymin=lo,ymax=hi))+
geom_ribbon(alpha=0.2)+ theme_bw() + ylab("cases") + ggtitle("TSIR cases with Data")
TSIRsim %>%
simulate(params=coef(TSIRsim),nsim=100,as.data.frame=TRUE,times= seq(1944,1985,by=7/365),include.data=TRUE) %>%
subset(select=c(time,sim,cases)) %>%
mutate(data=sim=="data") %>%
ddply(~time+data,summarize,
p=c(0.05,0.5,0.95),q=quantile(cases,prob=p,names=FALSE), mean_cases=mean(cases))->dta
TSIRsim %>%
simulate(params=coef(TSIRsim),nsim=100,as.data.frame=TRUE,times= seq(1944,1985,by=7/365),include.data=TRUE) %>%
subset(select=c(time,sim,cases)) %>%
mutate(data=sim=="data")->dta
View(dta)
TSIRsim %>%
simulate(params=coef(TSIRsim),nsim=100,as.data.frame=TRUE,times= seq(1944,1985,by=7/365),include.data=TRUE) %>%
subset(select=c(time,sim,cases)) %>%
mutate(data=sim=="data") %>% subset(sim!="data")%>%
ddply( .(time), summarize, mean_cases=mean(cases))->cl
View(cl)
TSIRsim %>%
simulate(params=coef(TSIRsim),nsim=100,as.data.frame=TRUE,times= seq(1944,1985,by=7/365),include.data=TRUE) %>%
subset(select=c(time,sim,cases)) %>%
mutate(data=sim=="data") %>% subset(sim!="data")%>%
ddply( .(time), summarize, sim = "mean", cases=mean(cases), data = "FALSE")->cl
dta %>% ddply( .(time), summarize, sim = "mean", cases=mean(cases), data = "FALSE") %>%
rbind(dta)
dta %>% ddply( .(time), summarize, sim = "mean", cases=mean(cases), data = "FALSE") %>%
rbind(dta)->cl
dta %>%
subset(sim!="data") %>%
ddply( .(time), summarize, sim = "mean", cases=mean(cases), data = "FALSE") %>%
rbind(dta)->cl
TSIRsim %>%
simulate(params=coef(TSIRsim),nsim=100,as.data.frame=TRUE,times= seq(1944,1985,by=7/365),include.data=TRUE) %>%
subset(select=c(time,sim,cases)) %>%
mutate(data=sim=="data") %>% subset(sim!="data")->dta
dta %>%
subset(sim!="data") %>%
ddply( .(time), summarize, sim = "mean", cases=mean(cases), data = "FALSE") %>%
rbind(dta)->dta
dta %>%
ddply(~time+data,summarize,
p=c(0.05,0.5,0.95),q=quantile(cases,prob=p,names=FALSE), mean_cases=mean(cases))%>%
mutate(p=mapvalues(p,from=c(0.05,0.5,0.95),to=c("lo","med","hi")),
data=mapvalues(data,from=c(TRUE,FALSE),to=c("data","simulation"))) %>%
dcast(time+data~p,value.var='q') %>%
ggplot(aes(x=time,y=med,color=data,fill=data,ymin=lo,ymax=hi))+
geom_ribbon(alpha=0.2)+ theme_bw() + ylab("cases") + ggtitle("TSIR cases with Data")
dta %>%
ddply(~time+data,summarize,
p=c(0.05,0.5,0.95),q=quantile(cases,prob=p,names=FALSE))%>%
mutate(p=mapvalues(p,from=c(0.05,0.5,0.95),to=c("lo","med","hi")),
data=mapvalues(data,from=c(TRUE,FALSE),to=c("data","simulation"))) %>%
dcast(time+data~p,value.var='q') %>%
ggplot(aes(x=time,y=med,color=data,fill=data,ymin=lo,ymax=hi))+
geom_ribbon(alpha=0.2)+ theme_bw() + ylab("cases") + ggtitle("TSIR cases with Data")
TSIRsim %>%
simulate(params=coef(TSIRsim),nsim=100,as.data.frame=TRUE,times= seq(1944,1985,by=7/365),include.data=TRUE) %>%
subset(select=c(time,sim,cases)) %>%
mutate(data=sim=="data") %>% subset(sim!="data")->dta
dta %>%
subset(sim!="data") %>%
ddply( .(time), summarize, sim = "mean", cases=mean(cases), data = "mean") %>%
rbind(dta)->dta
dta %>%
ddply(~time+data,summarize,
p=c(0.05,0.5,0.95),q=quantile(cases,prob=p,names=FALSE))%>%
mutate(p=mapvalues(p,from=c(0.05,0.5,0.95),to=c("lo","med","hi")),
data=mapvalues(data,from=c(TRUE,FALSE,"mean"),to=c("data","simulation","mean"))) %>%
dcast(time+data~p,value.var='q') %>%
ggplot(aes(x=time,y=med,color=data,fill=data,ymin=lo,ymax=hi))+
geom_ribbon(alpha=0.2)+ theme_bw() + ylab("cases") + ggtitle("TSIR cases with Data")
View(dta)
TSIRsim %>%
simulate(params=coef(TSIRsim),nsim=100,as.data.frame=TRUE,times= seq(1944,1985,by=7/365),include.data=TRUE) %>%
subset(select=c(time,sim,cases)) %>%
mutate(data=sim=="data") %>% subset(sim!="data")->dta
dta %>%
ddply( .(time), summarize, sim = "mean", cases=mean(cases), data = "mean") %>%
rbind(dta)->dta
dta %>%
ddply(~time+data,summarize,
p=c(0.05,0.5,0.95),q=quantile(cases,prob=p,names=FALSE))%>%
mutate(p=mapvalues(p,from=c(0.05,0.5,0.95),to=c("lo","med","hi")),
data=mapvalues(data,from=c(TRUE,FALSE,"mean"),to=c("data","simulation","mean"))) %>%
dcast(time+data~p,value.var='q') %>%
ggplot(aes(x=time,y=med,color=data,fill=data,ymin=lo,ymax=hi))+
geom_ribbon(alpha=0.2)+ theme_bw() + ylab("cases") + ggtitle("TSIR cases with Data")
TSIRsim %>%
simulate(params=coef(TSIRsim),nsim=100,as.data.frame=TRUE,times= seq(1944,1985,by=7/365),include.data=TRUE) %>%
subset(select=c(time,sim,cases)) %>%
mutate(data=sim=="data") %>% subset(sim!="data")->dta
TSIRsim %>%
simulate(params=coef(TSIRsim),nsim=100,as.data.frame=TRUE,times= seq(1944,1985,by=7/365),include.data=TRUE) %>%
subset(select=c(time,sim,cases)) %>%
mutate(data=sim=="data") ->dta
dta %>%
subset(sim!="data") %>%
ddply( .(time), summarize, sim = "mean", cases=mean(cases), data = "mean") %>%
rbind(dta)->cl
dta %>%
subset(sim!="data") %>%
ddply( .(time), summarize, sim = "mean", cases=mean(cases), data = "mean") %>%
rbind(dta)->dta
dta %>%
ddply(~time+data,summarize,
p=c(0.05,0.5,0.95),q=quantile(cases,prob=p,names=FALSE))%>%
mutate(p=mapvalues(p,from=c(0.05,0.5,0.95),to=c("lo","med","hi")),
data=mapvalues(data,from=c(TRUE,FALSE,"mean"),to=c("data","simulation","mean"))) %>%
dcast(time+data~p,value.var='q') %>%
ggplot(aes(x=time,y=med,color=data,fill=data,ymin=lo,ymax=hi))+
geom_ribbon(alpha=0.2)+ theme_bw() + ylab("cases") + ggtitle("TSIR cases with Data")
dta %>%
ddply(~time+data,summarize,
p=c(0.05,0.5,0.95),q=quantile(cases,prob=p,names=FALSE))%>%
mutate(p=mapvalues(p,from=c(0.05,0.5,0.95),to=c("lo","med","hi")),
data=mapvalues(data,from=c(TRUE,FALSE,"mean"),to=c("data","simulation","mean"))) %>%
dcast(time+data~p,value.var='q') %>%
ggplot(aes(x=time,y=med,color=data,fill=data,ymin=lo,ymax=hi))+
geom_ribbon(alpha=0.1)+ theme_bw() + ylab("cases") + ggtitle("TSIR cases with Data")
dta %>%
ddply(~time+data,summarize,
p=c(0.05,0.5,0.95),q=quantile(cases,prob=p,names=FALSE))%>%
mutate(p=mapvalues(p,from=c(0.05,0.5,0.95),to=c("lo","med","hi")),
data=mapvalues(data,from=c(TRUE,FALSE,"mean"),to=c("data","simulation","mean"))) %>%
dcast(time+data~p,value.var='q') %>%
ggplot(aes(x=time,y=med,color=data,ymin=lo,ymax=hi))+
geom_ribbon(alpha=0.1)+ theme_bw() + ylab("cases") + ggtitle("TSIR cases with Data")
dta %>% subset(data !=FALSE) %>%
ddply(~time+data,summarize,
p=c(0.05,0.5,0.95),q=quantile(cases,prob=p,names=FALSE))%>%
mutate(p=mapvalues(p,from=c(0.05,0.5,0.95),to=c("lo","med","hi")),
data=mapvalues(data,from=c(TRUE,FALSE,"mean"),to=c("data","simulation","mean"))) %>%
dcast(time+data~p,value.var='q') %>%
ggplot(aes(x=time,y=med,color=data,fill=data,ymin=lo,ymax=hi))+
geom_ribbon(alpha=0.1)+ theme_bw() + ylab("cases") + ggtitle("TSIR cases with Data")
dta %>% subset(data !=FALSE) %>%
# ddply(~time+data,summarize,
#       p=c(0.05,0.5,0.95),q=quantile(cases,prob=p,names=FALSE))%>%
# mutate(p=mapvalues(p,from=c(0.05,0.5,0.95),to=c("lo","med","hi")),
#        data=mapvalues(data,from=c(TRUE,FALSE,"mean"),to=c("data","simulation","mean"))) %>%
# dcast(time+data~p,value.var='q') %>%
ggplot(aes(x=time,y=med,color=data,fill=data,ymin=lo,ymax=hi))+
geom_ribbon(alpha=0.1)+ theme_bw() + ylab("cases") + ggtitle("TSIR cases with Data")
dta %>% subset(data !=FALSE) %>%
ggplot(aes(x=time,y=med,color=data,fill=data,ymin=lo,ymax=hi))+
geom_ribbon(alpha=0.1)+ theme_bw() + ylab("cases") + ggtitle("TSIR cases with Data")
dta %>% subset(data !=FALSE) %>%
ggplot(aes(x=time,y=cases,color=data,fill=data,ymin=lo,ymax=hi))+
geom_ribbon(alpha=0.1)+ theme_bw() + ylab("cases") + ggtitle("TSIR cases with Data")
dta %>% subset(data !=FALSE) %>%
ggplot(aes(x=time,y=cases,color=data))+
geom_ribbon(alpha=0.1)+ theme_bw() + ylab("cases") + ggtitle("TSIR cases with Data")
dta %>% subset(data !=FALSE) %>%
ggplot(aes(x=time,y=cases,color=data))+
geom_ribbon(alpha=0.1)+ theme_bw() + ylab("cases") + ggtitle("TSIR cases with Data")
dta %>% subset(data !=FALSE) %>%
ggplot(aes(x=time,y=cases,color=data))+
theme_bw() + ylab("cases") + ggtitle("TSIR cases with Data")
ggplot(dta, mapping=aes(x=time, y=cases, color=data,linetype=data)) +
geom_line() + ggtitle("title") +
xlab("time") + ylab("cases") + theme_bw()
ggplot(subset(data !=FALSE), mapping=aes(x=time, y=cases, color=data,linetype=data)) +
geom_line() + ggtitle("title") +
xlab("time") + ylab("cases") + theme_bw()
ggplot(subset(dta,data !=FALSE), mapping=aes(x=time, y=cases, color=data,linetype=data)) +
geom_line() + ggtitle("title") +
xlab("time") + ylab("cases") + theme_bw()
ggplot(subset(dta,data !=FALSE), mapping=aes(x=time, y=cases, color=data)) +
geom_line() + ggtitle("title") +
xlab("time") + ylab("cases") + theme_bw()
ggplot(subset(dta,data !=FALSE), mapping=aes(x=time, y=cases, color=data,linetype=data)) +
geom_line() + ggtitle("title") +
xlab("time") + ylab("cases") + theme_bw()
TSIRsim %>%
simulate(params=coef(TSIRsim),nsim=9,as.data.frame=TRUE,include.data=TRUE) %>%
ggplot(aes(x=time,y=cases,group=sim,color=(sim=="data")))+
guides(color=FALSE)+
geom_line()+facet_wrap(~sim,ncol=2)
TSIRsim %>%
simulate(params=coef(TSIRsim),nsim=9,as.data.frame=TRUE,include.data=TRUE) %>%
ggplot(aes(x=time,y=cases,group=sim,color=(sim=="data")))+
guides(color=FALSE)+
geom_line()+facet_wrap(~sim,ncol=2) + ggtitle("TSIR model simulations with Data")+ theme_bw()
TSIRsim %>%
simulate(params=coef(TSIRsim),nsim=5,as.data.frame=TRUE,include.data=TRUE) %>%
ggplot(aes(x=time,y=cases,group=sim,color=(sim=="data")))+
guides(color=FALSE)+
geom_line()+facet_wrap(~sim,ncol=2) + ggtitle("TSIR model simulations with Data")+ theme_bw()
TSIRsim %>%
simulate(params=coef(TSIRsim),nsim=100,as.data.frame=TRUE,times= seq(1944,1985,by=7/365),include.data=TRUE) %>%
subset(select=c(time,sim,cases)) %>%
mutate(data=sim=="data") %>%
ddply(~time+data,summarize,
p=c(0.05,0.5,0.95),q=quantile(cases,prob=p,names=FALSE)) %>%
mutate(p=mapvalues(p,from=c(0.05,0.5,0.95),to=c("lo","med","hi")),
data=mapvalues(data,from=c(TRUE,FALSE),to=c("data","simulation"))) %>%
dcast(time+data~p,value.var='q') %>%
ggplot(aes(x=time,y=med,color=data,fill=data,ymin=lo,ymax=hi))+
geom_ribbon(alpha=0.2)+ theme_bw() + ylab("cases") + ggtitle("TSIR cases with Data")
TSIRsim %>%
simulate(params=coef(TSIRsim),nsim=100,as.data.frame=TRUE,times= seq(1944,1985,by=7/365),include.data=TRUE) %>%
subset(select=c(time,sim,cases)) %>%
mutate(data=sim=="data") %>%
ddply(~time+data,summarize,
p=c(0.05,0.5,0.95),q=quantile(cases,prob=p,names=FALSE)) %>%
mutate(p=mapvalues(p,from=c(0.05,0.5,0.95),to=c("lo","med","hi")),
data=mapvalues(data,from=c(TRUE,FALSE),to=c("data","simulation"))) %>%
dcast(time+data~p,value.var='q') %>%
ggplot(aes(x=time,y=med,color=data,fill=data,ymin=lo,ymax=hi))+
geom_ribbon(alpha=0.2)+ theme_bw() + ylab("cases") + ggtitle("TSIR cases variability with Data")
TSIRsim %>%
simulate(params=coef(TSIRsim),nsim=100,as.data.frame=TRUE,times= seq(1944,1985,by=7/365),include.data=TRUE) %>%
subset(select=c(time,sim,cases)) %>%
mutate(data=sim=="data") ->dta
dta %>%
subset(sim!="data") %>%
ddply( .(time), summarize, sim = "mean", cases=mean(cases), data = "mean") %>%
rbind(dta)->dta
ggplot(subset(dta,data !=FALSE), mapping=aes(x=time, y=cases, color=data)) +
geom_line() + ggtitle("TSIR mean cases with data") +
xlab("time") + ylab("cases") + theme_bw()
TSIR %>%
simulate(params=coef(firstFit),nsim=5,as.data.frame=TRUE,include.data=TRUE) %>%
ggplot(aes(x=time,y=cases,group=sim,color=(sim=="data")))+
guides(color=FALSE)+
geom_line()+facet_wrap(~sim,ncol=2)+ ggtitle("TSIR Cases Reconstruction")+theme_bw()
TSIR %>%
simulate(params=coef(firstFit),nsim=100,as.data.frame=TRUE,include.data=TRUE) %>%
subset(select=c(time,sim,cases)) %>%
mutate(data=sim=="data") %>%
ddply(~time+data,summarize,
p=c(0.05,0.5,0.95),q=quantile(cases,prob=p,names=FALSE)) %>%
mutate(p=mapvalues(p,from=c(0.05,0.5,0.95),to=c("lo","med","hi")),
data=mapvalues(data,from=c(TRUE,FALSE),to=c("data","simulation"))) %>%
dcast(time+data~p,value.var='q') %>%
ggplot(aes(x=time,y=med,color=data,fill=data,ymin=lo,ymax=hi))+
geom_ribbon(alpha=0.2)+ theme_bw() + ylab("cases") + ggtitle("TSIR cases reconstructed with Data")
TSIR %>%
simulate(params=coef(firstFit),nsim=100,as.data.frame=TRUE,times= seq(1944,1985,by=7/365),include.data=TRUE) %>%
subset(select=c(time,sim,cases)) %>%
mutate(data=sim=="data") ->dta
dta %>%
subset(sim!="data") %>%
ddply( .(time), summarize, sim = "mean", cases=mean(cases), data = "mean") %>%
rbind(dta)->dta
ggplot(subset(dta,data !=FALSE), mapping=aes(x=time, y=cases, color=data)) +
geom_line() + ggtitle("TSIR reconstructed mean cases with data") +
xlab("time") + ylab("cases") + theme_bw()
TSIR %>%
simulate(params=coef(firstFit),nsim=100,as.data.frame=TRUE,include.data=TRUE) %>%
subset(select=c(time,sim,cases)) %>%
mutate(data=sim=="data") ->dta
dta %>%
subset(sim!="data") %>%
ddply( .(time), summarize, sim = "mean", cases=mean(cases), data = "mean") %>%
rbind(dta)->dta
ggplot(subset(dta,data !=FALSE), mapping=aes(x=time, y=cases, color=data, linetype = data)) +
geom_line() + ggtitle("TSIR reconstructed mean cases with data") +
xlab("time") + ylab("cases") + theme_bw()
TSIR %>%
simulate(params=coef(firstFit),nsim=100,as.data.frame=TRUE,include.data=TRUE) %>%
subset(select=c(time,sim,cases)) %>%
mutate(data=sim=="data") %>%
ddply(~time+data,summarize,
p=c(0.05,0.5,0.95),q=quantile(cases,prob=p,names=FALSE)) %>%
mutate(p=mapvalues(p,from=c(0.05,0.5,0.95),to=c("lo","med","hi")),
data=mapvalues(data,from=c(TRUE,FALSE),to=c("data","simulation"))) %>%
dcast(time+data~p,value.var='q') %>%
ggplot(aes(x=time,y=med,color=data,fill=data,ymin=lo,ymax=hi))+
geom_ribbon(alpha=0.2)+ theme_bw() + ylab("cases") + ggtitle("TSIR  reconstructed cases variability with Data")
coef(TSIRsim) = coef(firstFit)
TSIRsim %>%
simulate(params=coef(TSIRsim),nsim=5,as.data.frame=TRUE,include.data=TRUE) %>%
ggplot(aes(x=time,y=cases,group=sim,color=(sim=="data")))+
guides(color=FALSE)+
geom_line()+facet_wrap(~sim,ncol=2) + ggtitle("TSIR model simulations with Data")+ theme_bw()
TSIRsim %>%
simulate(params=coef(TSIRsim),nsim=100,as.data.frame=TRUE,times= seq(1944,1985,by=7/365),include.data=TRUE) %>%
subset(select=c(time,sim,cases)) %>%
mutate(data=sim=="data") %>%
ddply(~time+data,summarize,
p=c(0.05,0.5,0.95),q=quantile(cases,prob=p,names=FALSE)) %>%
mutate(p=mapvalues(p,from=c(0.05,0.5,0.95),to=c("lo","med","hi")),
data=mapvalues(data,from=c(TRUE,FALSE),to=c("data","simulation"))) %>%
dcast(time+data~p,value.var='q') %>%
ggplot(aes(x=time,y=med,color=data,fill=data,ymin=lo,ymax=hi))+
geom_ribbon(alpha=0.2)+ theme_bw() + ylab("cases") + ggtitle("TSIR cases variability with Data")
TSIRsim %>%
simulate(params=coef(TSIRsim),nsim=100,as.data.frame=TRUE,times= seq(1944,1985,by=7/365),include.data=TRUE) %>%
subset(select=c(time,sim,cases)) %>%
mutate(data=sim=="data") ->dta
dta %>%
subset(sim!="data") %>%
ddply( .(time), summarize, sim = "mean", cases=mean(cases), data = "mean") %>%
rbind(dta)->dta
ggplot(subset(dta,data !=FALSE), mapping=aes(x=time, y=cases, color=data)) +
geom_line() + ggtitle("TSIR mean cases with data") +
xlab("time") + ylab("cases") + theme_bw()
coef(TSIRsim) = coef(firstFit)
TSIRsim %>%
simulate(params=coef(TSIRsim),nsim=5,as.data.frame=TRUE,include.data=TRUE) %>%
ggplot(aes(x=time,y=cases,group=sim,color=(sim=="data")))+
guides(color=FALSE)+
geom_line()+facet_wrap(~sim,ncol=2) + ggtitle("TSIR model simulations with Data")+ theme_bw()
TSIRsim %>%
simulate(params=coef(TSIRsim),nsim=5,as.data.frame=TRUE,include.data=TRUE) %>%
ggplot(aes(x=time,y=cases,group=sim,color=(sim=="data")))+
guides(color=FALSE)+
geom_line()+facet_wrap(~sim,ncol=2) + ggtitle("TSIR model simulations with Data")+ theme_bw()
TSIRsim %>%
simulate(params=coef(TSIRsim),nsim=5,as.data.frame=TRUE,include.data=TRUE) %>%
ggplot(aes(x=time,y=cases,group=sim,color=(sim=="data")))+
guides(color=FALSE)+
geom_line()+facet_wrap(~sim,ncol=2) + ggtitle("TSIR model simulations with Data")+ theme_bw()
TSIRsim %>%
simulate(params=coef(TSIRsim),nsim=5,as.data.frame=TRUE,include.data=TRUE) %>%
ggplot(aes(x=time,y=cases,group=sim,color=(sim=="data")))+
guides(color=FALSE)+
geom_line()+facet_wrap(~sim,ncol=2) + ggtitle("TSIR model simulations with Data")+ theme_bw()
pomp(London_cases,times="times",t0=1944,
rprocess=discrete.time.sim(step.fun=stochStepF,delta.t=1/26.01786),
paramnames=c("m","B1","B2","B3","B4","B5","B6","B7","B8","B9","B10","B11",
"B12","B13","B14","B15","B16","B17","B18","B19","B20","B21",
"B22","B23","B24","B25","B26",
"alpha","Sbar"),
initializer=initls,
params = c(m=13, B1 = 1.285935e-05, B2 = 1.214533e-05, B3 = 1.464063e-05, B4 = 1.277254e-05, B5 = 1.236623e-05, B6 = 1.181611e-05,
B7 = 1.059032e-05, B8 = 1.183479e-05, B9 = 1.024478e-05, B10 = 1.099727e-05,
B11 = 1.065480e-05, B12 = 1.136872e-05, B13 = 9.970371e-06, B14 = 9.655970e-06, B15 = 8.828046e-06, B16 = 8.999024e-06 ,
B17 = 6.775660e-06, B18 = 6.917613e-06, B19 = 7.245048e-06, B20 = 1.110509e-05,
B21 = 1.418629e-05, B22 = 1.017632e-05, B23 = 1.180947e-05, B24 = 1.052219e-05, B25 = 1.050035e-05 , B26 = 1.175871e-05,
alpha = 9.70e-01 , Sbar = 114281.6),
statenames=c("I","lambda","S","noise","theta"),
rmeasure = rmeass,
dmeasure = dmeass,
toEstimationScale = toEsts,
fromEstimationScale = fromEsts,
covar = Covar,
tcovar= "time") -> TSIRsim
TSIRsim %>%
simulate(params=coef(TSIRsim),nsim=5,as.data.frame=TRUE,include.data=TRUE) %>%
ggplot(aes(x=time,y=cases,group=sim,color=(sim=="data")))+
guides(color=FALSE)+
geom_line()+facet_wrap(~sim,ncol=2) + ggtitle("TSIR model simulations with Data")+ theme_bw()
TSIRsim %>%
simulate(params=coef(TSIRsim),nsim=100,as.data.frame=TRUE,times= seq(1944,1985,by=7/365),include.data=TRUE) %>%
subset(select=c(time,sim,cases)) %>%
mutate(data=sim=="data") %>%
ddply(~time+data,summarize,
p=c(0.05,0.5,0.95),q=quantile(cases,prob=p,names=FALSE)) %>%
mutate(p=mapvalues(p,from=c(0.05,0.5,0.95),to=c("lo","med","hi")),
data=mapvalues(data,from=c(TRUE,FALSE),to=c("data","simulation"))) %>%
dcast(time+data~p,value.var='q') %>%
ggplot(aes(x=time,y=med,color=data,fill=data,ymin=lo,ymax=hi))+
geom_ribbon(alpha=0.2)+ theme_bw() + ylab("cases") + ggtitle("TSIR cases variability with Data")
TSIRsim %>%
simulate(params=coef(firstFit),nsim=100,as.data.frame=TRUE,times= seq(1944,1985,by=7/365),include.data=TRUE) %>%
subset(select=c(time,sim,cases)) %>%
mutate(data=sim=="data") %>%
ddply(~time+data,summarize,
p=c(0.05,0.5,0.95),q=quantile(cases,prob=p,names=FALSE)) %>%
mutate(p=mapvalues(p,from=c(0.05,0.5,0.95),to=c("lo","med","hi")),
data=mapvalues(data,from=c(TRUE,FALSE),to=c("data","simulation"))) %>%
dcast(time+data~p,value.var='q') %>%
ggplot(aes(x=time,y=med,color=data,fill=data,ymin=lo,ymax=hi))+
geom_ribbon(alpha=0.2)+ theme_bw() + ylab("cases") + ggtitle("TSIR cases variability with Data")
TSIRsim %>%
simulate(params=coef(TSIRsim),nsim=5,as.data.frame=TRUE,include.data=TRUE) %>%
ggplot(aes(x=time,y=cases,group=sim,color=(sim=="data")))+
guides(color=FALSE)+
geom_line()+facet_wrap(~sim,ncol=2) + ggtitle("TSIR model simulations with Data")+ theme_bw()
TSIRsim %>%
simulate(params=coef(TSIRsim),nsim=5,as.data.frame=TRUE,include.data=TRUE) %>%
ggplot(aes(x=time,y=cases,group=sim,color=(sim=="data")))+
guides(color=FALSE)+
geom_line()+facet_wrap(~sim,ncol=2) + ggtitle("TSIR model simulations with Data")+ theme_bw()
TSIRsim %>%
simulate(params=coef(TSIRsim),nsim=5,as.data.frame=TRUE,include.data=TRUE) %>%
ggplot(aes(x=time,y=cases,group=sim,color=(sim=="data")))+
guides(color=FALSE)+
geom_line()+facet_wrap(~sim,ncol=2) + ggtitle("TSIR model simulations with Data")+ theme_bw()
TSIRsim %>%
simulate(params=coef(TSIRsim),nsim=100,as.data.frame=TRUE,times= seq(1944,1985,by=7/365),include.data=TRUE) %>%
subset(select=c(time,sim,cases)) %>%
mutate(data=sim=="data") ->dta
dta %>%
subset(sim!="data") %>%
ddply( .(time), summarize, sim = "mean", cases=mean(cases), data = "mean") %>%
rbind(dta)->dta
ggplot(subset(dta,data !=FALSE), mapping=aes(x=time, y=cases, color=data)) +
geom_line() + ggtitle("TSIR mean cases with data") +
xlab("time") + ylab("cases") + theme_bw()
TSIRsim %>%
simulate(params=coef(firstFit),nsim=100,as.data.frame=TRUE,times= seq(1944,1985,by=7/365),include.data=TRUE) %>%
subset(select=c(time,sim,cases)) %>%
mutate(data=sim=="data") ->dta
dta %>%
subset(sim!="data") %>%
ddply( .(time), summarize, sim = "mean", cases=mean(cases), data = "mean") %>%
rbind(dta)->dta
ggplot(subset(dta,data !=FALSE), mapping=aes(x=time, y=cases, color=data)) +
geom_line() + ggtitle("TSIR mean cases with data") +
xlab("time") + ylab("cases") + theme_bw()
pomp(London_cases,times="times",t0=1944,
rprocess=discrete.time.sim(step.fun=stochStep,delta.t=1/26.01786),
paramnames=c("m","B1","B2","B3","B4","B5","B6","B7","B8","B9","B10","B11",
"B12","B13","B14","B15","B16","B17","B18","B19","B20","B21",
"B22","B23","B24","B25","B26",
"alpha","Sbar"),
initializer=initlz,
params = c(m=13, B1 = 1.285935e-05, B2 = 1.214533e-05, B3 = 1.464063e-05, B4 = 1.277254e-05, B5 = 1.236623e-05, B6 = 1.181611e-05,
B7 = 1.059032e-05, B8 = 1.183479e-05, B9 = 1.024478e-05, B10 = 1.099727e-05,
B11 = 1.065480e-05, B12 = 1.136872e-05, B13 = 9.970371e-06, B14 = 9.655970e-06, B15 = 8.828046e-06, B16 = 8.999024e-06 ,
B17 = 6.775660e-06, B18 = 6.917613e-06, B19 = 7.245048e-06, B20 = 1.110509e-05,
B21 = 1.418629e-05, B22 = 1.017632e-05, B23 = 1.180947e-05, B24 = 1.052219e-05, B25 = 1.050035e-05 , B26 = 1.175871e-05,
alpha = 9.70e-01 , Sbar = 114281.6),
statenames=c("I","lambda","theta"),
rmeasure = rmeas,
dmeasure = dmeas,
toEstimationScale = toEst,
fromEstimationScale = fromEst,
covar = Covar,
tcovar= "time") -> TSIR
TSIR %>%
simulate(params=coef(TSIR),nsim=5,as.data.frame=TRUE,include.data=TRUE) %>%
ggplot(aes(x=time,y=cases,group=sim,color=(sim=="data")))+
guides(color=FALSE)+
geom_line()+facet_wrap(~sim,ncol=2)+ ggtitle("TSIR Cases Reconstruction")+theme_bw()
TSIR %>%
simulate(params=coef(TSIR),nsim=100,as.data.frame=TRUE,include.data=TRUE) %>%
subset(select=c(time,sim,cases)) %>%
mutate(data=sim=="data") %>%
ddply(~time+data,summarize,
p=c(0.05,0.5,0.95),q=quantile(cases,prob=p,names=FALSE)) %>%
mutate(p=mapvalues(p,from=c(0.05,0.5,0.95),to=c("lo","med","hi")),
data=mapvalues(data,from=c(TRUE,FALSE),to=c("data","simulation"))) %>%
dcast(time+data~p,value.var='q') %>%
ggplot(aes(x=time,y=med,color=data,fill=data,ymin=lo,ymax=hi))+
geom_ribbon(alpha=0.2)+ theme_bw() + ylab("cases") + ggtitle("TSIR  reconstructed cases variability with Data")
TSIR %>%
simulate(params=coef(TSIR),nsim=100,as.data.frame=TRUE,include.data=TRUE) %>%
subset(select=c(time,sim,cases)) %>%
mutate(data=sim=="data") ->dta
dta %>%
subset(sim!="data") %>%
ddply( .(time), summarize, sim = "mean", cases=mean(cases), data = "mean") %>%
rbind(dta)->dta
ggplot(subset(dta,data !=FALSE), mapping=aes(x=time, y=cases, color=data, linetype = data)) +
geom_line() + ggtitle("TSIR reconstructed mean cases with data") +
xlab("time") + ylab("cases") + theme_bw()
